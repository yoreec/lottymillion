<html>
<head>
    <title>–†–µ–∫–ª–∞–º–Ω–∞—è –ª–æ—Ç–µ—Ä–µ—è üé∞</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f2f5;
            margin: 0;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .balance-card, .referral-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .referral-card {
            background: linear-gradient(90deg, #ff6b6b, #ff9f43);
            color: white;
        }
        
        .button {
            display: block;
            width: 100%;
            padding: 15px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .button:active {
            transform: scale(0.98);
        }
        
        .referral-code {
            background: rgba(255,255,255,0.2);
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-block;
            margin: 10px 0;
        }
        
        .timer {
            color: #0088cc;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéâ –ó–∞—Ä–∞–±–æ—Ç–∞–π –Ω–∞ –ª–æ—Ç–µ—Ä–µ–µ!</h1>
            <p>–°–º–æ—Ç—Ä–∏ —Ä–µ–∫–ª–∞–º—É ‚û°Ô∏è –ø–æ–ª—É—á–∞–π –±–∏–ª–µ—Ç—ã ‚û°Ô∏è –≤—ã–∏–≥—Ä—ã–≤–∞–π –¥–µ–Ω—å–≥–∏!</p>
        </div>
        
        <div class="referral-card">
            <h3>üë• –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ (+5 –±–∏–ª–µ—Ç–æ–≤!)</h3>
            <p>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞: 
                <span class="referral-code" onclick="copyReferralLink()" id="referralLink">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </p>
            <p>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ: <span id="referralCount">0</span> –¥—Ä—É–∑–µ–π</p>
        </div>

        <div class="balance-card">
            <h3>üé´ –í–∞—à–∏ –±–∏–ª–µ—Ç—ã: <span id="tickets">0</span></h3>
            <p>–°–ª–µ–¥—É—é—â–∏–π —Ä–æ–∑—ã–≥—Ä—ã—à —á–µ—Ä–µ–∑: <span class="timer" id="timer">00:00:00</span></p>
        </div>
        
        <button class="button" id="watchAd">üì∫ –°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É (+1 –±–∏–ª–µ—Ç)</button>
        
        <div class="balance-card">
            <h2>üèÜ –î–∂–µ–∫–ø–æ—Ç: <span id="jackpot">100</span> RUB</h2>
            <p>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—å: <span id="lastWinner">...</span></p>
        </div>
    </div>

    <script>
        const webApp = Telegram.WebApp;
        webApp.ready();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let state = {
            tickets: parseInt(localStorage.getItem('tickets')) || 0,
            jackpot: parseInt(localStorage.getItem('jackpot')) || 100,
            lastWinner: localStorage.getItem('lastWinner') || '–µ—â–µ –Ω–µ—Ç',
            nextDraw: parseInt(localStorage.getItem('nextDraw')) || Date.now() + 86400000,
            referralCode: localStorage.getItem('referralCode') || generateReferralCode(),
            referralCount: parseInt(localStorage.getItem('referralCount')) || 0,
            referredBy: localStorage.getItem('referredBy') || null,
            rewarded: localStorage.getItem('rewarded') === 'true' || false
        };

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
        function generateReferralCode() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
        function copyReferralLink() {
            const link = `https://t.me/${webApp.initDataUnsafe.user.username}?startapp=${state.referredBy}`;
            navigator.clipboard.writeText(link)
                .then(() => webApp.showAlert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!'))
                .catch(() => webApp.showAlert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è'));
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        function checkReferral() {
            const params = new URLSearchParams(webApp.initDataUnsafe.start_param);
            const referrer = params.get('ref');
            
            if(referrer && !state.referredBy && referrer !== state.referralCode) {
                state.referredBy = referrer;
                localStorage.setItem('referredBy', referrer);
                webApp.showPopup({
                    title: 'üéÅ –†–µ—Ñ–µ—Ä–∞–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω!',
                    message: '–í—ã –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å –ø–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∫–ª–∞–º—ã'
                });
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('tickets').textContent = state.tickets;
            document.getElementById('jackpot').textContent = state.jackpot;
            document.getElementById('lastWinner').textContent = state.lastWinner;
            document.getElementById('referralLink').textContent = state.referralCode;
            document.getElementById('referralCount').textContent = state.referralCount;
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            localStorage.setItem('tickets', state.tickets);
            localStorage.setItem('jackpot', state.jackpot);
            localStorage.setItem('lastWinner', state.lastWinner);
            localStorage.setItem('nextDraw', state.nextDraw);
            localStorage.setItem('referralCode', state.referralCode);
            localStorage.setItem('referralCount', state.referralCount);
            localStorage.setItem('rewarded', state.rewarded);
        }

        // –¢–∞–π–º–µ—Ä
        function updateTimer() {
            const now = Date.now();
            const diff = state.nextDraw - now;
            
            if(diff <= 0) {
                conductLottery();
                return;
            }
            
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            
            document.getElementById('timer').textContent = 
                `${String(hours).padStart(2, '0')}:` +
                `${String(minutes).padStart(2, '0')}:` +
                `${String(seconds).padStart(2, '0')}`;
        }

        // –õ–æ—Ç–µ—Ä–µ—è
        function conductLottery() {
            const winChance = state.tickets / (state.tickets + 100);
            const winner = Math.random() < winChance ? '–í—ã!' : '–î—Ä—É–≥–æ–π –∏–≥—Ä–æ–∫';
            
            state.lastWinner = winner;
            state.jackpot += Math.floor(state.tickets * 0.1);
            state.nextDraw = Date.now() + 86400000;
            
            if(winner === '–í—ã!') {
                webApp.showPopup({
                    title: 'üéâ –ü–æ–±–µ–¥–∞!',
                    message: `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${state.jackpot} RUB!`
                });
                state.jackpot = 100;
            }
            
            state.tickets = 0;
            updateUI();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∫–ª–∞–º—ã
        document.getElementById('watchAd').addEventListener('click', () => {
            webApp.showPopup({
                title: '–†–µ–∫–ª–∞–º–∞',
                message: '–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∫–ª–∞–º—ã...'
            });
            
            setTimeout(() => {
                state.tickets++;
                
                // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
                if(state.referredBy && !state.rewarded) {
                    state.rewarded = true;
                    state.tickets += 5;
                    state.referralCount++;
                    webApp.showAlert('+5 –±–∏–ª–µ—Ç–æ–≤ –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞!');
                }
                
                updateUI();
                webApp.showAlert('+1 –±–∏–ª–µ—Ç –ø–æ–ª—É—á–µ–Ω!');
            }, 3000);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        checkReferral();
        setInterval(updateTimer, 1000);
        updateUI();
        updateTimer();
    </script>
</body>
</html>
